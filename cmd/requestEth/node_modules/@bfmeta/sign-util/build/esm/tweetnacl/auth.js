"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.auth_full = exports.auth = void 0;
const array_1 = require("./array");
const hash_1 = require("./hash");
function auth(msg, key) {
    const out = new array_1.ByteArray(32);
    out.set(hmac(msg, key).subarray(0, 32));
    return out;
}
exports.auth = auth;
const BLOCK_SIZE = 128;
const HASH_SIZE = 64;
function hmac(msg, key) {
    const buf = new array_1.ByteArray(BLOCK_SIZE + Math.max(HASH_SIZE, msg.length));
    let i, innerHash;
    if (key.length > BLOCK_SIZE)
        key = (0, hash_1.hash)(key);
    for (i = 0; i < BLOCK_SIZE; i++)
        buf[i] = 0x36;
    for (i = 0; i < key.length; i++)
        buf[i] ^= key[i];
    buf.set(msg, BLOCK_SIZE);
    innerHash = (0, hash_1.hash)(buf.subarray(0, BLOCK_SIZE + msg.length));
    for (i = 0; i < BLOCK_SIZE; i++)
        buf[i] = 0x5c;
    for (i = 0; i < key.length; i++)
        buf[i] ^= key[i];
    buf.set(innerHash, BLOCK_SIZE);
    return (0, hash_1.hash)(buf.subarray(0, BLOCK_SIZE + innerHash.length));
}
exports.auth_full = hmac;
//# sourceMappingURL=auth.js.map